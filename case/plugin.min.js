/**
 * @copyright ©Melqui Brito. All rights reserved.
 * @author Melqui Brito
 * @version 1.2.0 (2020-03-08)
 * @description Tinymce custom plugin for changing text case.
 */

 !function(){tinymce.PluginManager.add("case",function(t){const e="Change Case",n="lowercase",o="UPPERCASE",s="Sentence case",r="Title Case",i=["at","by","in","of","on","up","to","en","re","vs","but","off","out","via","bar","mid","per","pro","qua","til","from","into","unto","with","amid","anit","atop","down","less","like","near","over","past","plus","sans","save","than","thru","till","upon","for","and","nor","but","or","yet","so","an","a","some","the"],a=function(e){let n=t.getParam(e);if(n){if(Array.isArray(n))return n;if("string"==typeof n)return n.replace(/(\s{1,})/g,"?").trim().split("?")}return"title_case_minors"===e&&i};var c=a("title_case_minors"),l=a("include_to_title_case_minors"),f=a("rule_out_from_title_case_minors");l&&l.forEach(t=>{-1===i.indexOf(t)&&i.push(t)}),f&&f.forEach(t=>{i=i.filter(e=>e!==t)}),String.prototype.toSentenceCase=function(){return this.toLowerCase().replace(/(^\s*\w|[\.\!\?]\s*\w)/g,function(t){return t.toUpperCase()})},String.prototype.toTitleCase=function(){return(t=>{let e=t.split(".");for(let t in e){if(e.hasOwnProperty(t)){let n=e[t].split(" "),o=0;if(e[t].trim().replace(/(^\s+|\s+$)/g,"").length>0){for(;o<n.length;o++){let t=!1;for(let e=0;e<n[o].length;e++)if(n[o][e].match(/([a-z'áàâãäéèêëíìîïóòôõöúùûü])/i)){n[o]=n[o][e].toUpperCase()+n[o].slice(e+1),t=!0;break}if(t)break}for(;o<n.length;o++)if(-1===c.indexOf(n[o]))for(let t=0;t<n[o].length;t++)if(n[o][t].match(/([a-z'áàâãäéèêëíìîïóòôõöúùûü])/i)){n[o]=n[o][t].toUpperCase()+n[o].slice(t+1);break}e[t]=n.join(" ")}}}return e.join(".")})(this.toLowerCase())},String.prototype.apply=function(t){switch(t){case n:return this.toLowerCase();case o:return this.toUpperCase();case s:return this.toSentenceCase();case r:return this.toTitleCase();default:return this}};const u=function(t,e,n){n.first&&n.last?t.textContent=t.textContent.slice(0,n.startOffset)+t.textContent.slice(n.startOffset,n.endOffset).apply(e)+t.textContent.slice(n.endOffset):n.first&&!n.last?t.textContent=t.textContent.slice(0,n.startOffset)+t.textContent.slice(n.startOffset).apply(e):!n.first&&n.last?t.textContent=t.textContent.slice(0,n.endOffset).apply(e)+t.textContent.slice(n.endOffset):t.textContent=t.textContent.apply(e)},m=function(e){let n=t.selection.getRng(),o=t.selection.getBookmark(2,!0),s=new tinymce.dom.TreeWalker(n.startContainer),r=n.startContainer,i=n.endContainer,a=n.startOffset,c=n.endOffset,l=s.current();do{if("#text"===l.nodeName&&(u(l,e,{first:l===r,last:l===i,startOffset:a,endOffset:c})),l===i)break;l=s.next()}while(l);t.save(),t.isNotDirty=!0,t.focus(),t.selection.moveToBookmark(o)},p=function(){return[{type:"menuitem",text:n,onAction:()=>m(n)},{type:"menuitem",text:o,onAction:()=>m(o)},{type:"menuitem",text:s,onAction:()=>m(s)},{type:"menuitem",text:r,onAction:()=>m(r)}]};return t.ui.registry.addMenuButton("case",{icon:"change-case",tooltip:e,fetch:function(t){t(p())}}),t.ui.registry.addNestedMenuItem("case",{text:e,getSubmenuItems:()=>p()}),t.addCommand("mceLowerCase",()=>m(n)),t.addCommand("mceUpperCase",()=>m(o)),t.addCommand("mceSentenceCase",()=>m(s)),t.addCommand("mceTitleCase",()=>m(r)),{getMetadata:function(){return{name:"Case",url:"https://github.com/melquibrito/Case-change-tinymce-plugin"}}}})}();
